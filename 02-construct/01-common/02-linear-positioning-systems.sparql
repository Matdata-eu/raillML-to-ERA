PREFIX dct: <http://purl.org/dc/terms/>
PREFIX era: <http://data.europa.eu/949/>
PREFIX fx: <http://sparql.xyz/facade-x/ns/>
PREFIX railml: <https://www.railml.org/schemas/3.2#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX xyz: <http://sparql.xyz/facade-x/data/>

CONSTRUCT {
  ?eraLPS a era:LinearPositioningSystem ;
          rdfs:label ?name ;
          dct:identifier ?lpsId .
}
WHERE {
  # Extract railML linearPositioningSystem elements
  ?lps a railml:linearPositioningSystem ;
       xyz:id ?lpsId .

  # Optional: name from nested name element
  OPTIONAL {
    ?lps fx:name ?nameNode .
    ?nameNode xyz:name ?nameValue .
    OPTIONAL {
      ?nameNode xyz:language ?lang
    }
    BIND (IF(BOUND(?lang),STRLANG(?nameValue,?lang),?nameValue) AS ?name)
  }
  
  # Mint ERA URI: linearPositioningSystems/{id}
  BIND (IRI(CONCAT("http://data.europa.eu/949/linearPositioningSystems/", ?lpsId)) AS ?eraLPS)
}
